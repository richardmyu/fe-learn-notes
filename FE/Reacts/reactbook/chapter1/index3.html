<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>ä¼˜åŒ–DOMæ“ä½œ-2</title>
</head>

<body>
  <div class="wrapper"></div>
  <script>
    /* 
    æ‰‹åŠ¨ç®¡ç†æ•°æ®å’Œ DOM ä¹‹é—´çš„å…³ç³»ä¼šå¯¼è‡´ä»£ç å¯ç»´æŠ¤æ€§å˜å·®ã€å®¹æ˜“å‡ºé”™ã€‚å¦‚ä½•å°½é‡å‡å°‘è¿™ç§æ‰‹åŠ¨ DOM æ“ä½œï¼Ÿ

    è¿™é‡Œè¦æå‡ºçš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼šä¸€æ—¦çŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼Œå°±é‡æ–°è°ƒç”¨ render æ–¹æ³•ï¼Œæ„å»ºä¸€ä¸ªæ–°çš„ DOM å…ƒç´ ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå¥½å¤„å°±æ˜¯ä½ å¯ä»¥åœ¨ render æ–¹æ³•é‡Œé¢ä½¿ç”¨æœ€æ–°çš„ this.state æ¥æ„é€ ä¸åŒ HTML ç»“æ„çš„å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”é€šè¿‡è¿™ä¸ªå­—ç¬¦ä¸²æ„é€ ä¸åŒçš„ DOM å…ƒç´ ã€‚é¡µé¢å°±æ›´æ–°äº†ï¼
     */
    const createDOMFromString = (domString) => {
      const div = document.createElement('div');
      div.innerHTML = domString;
      return div;
    };
    class LikeButton {
      constructor() {
        this.state = {
          isLiked: false
        }
        this.changeLikeText = this.changeLikeText.bind(this);
      }
      setState(state) {
        // this.state = state;
        // this.el = this.render();
        const oldEl = this.el;
        this.state = state;
        this.el = this.render();
        // å®ä¾‹åŒ–ä»¥åæ—¶å€™è¢«è®¾ç½®çš„ï¼Œæ‰€ä»¥ä½ å¯ä»¥è‡ªå®šä¹‰ onStateChange çš„è¡Œä¸º
        /* 
        æ¯å½“ setState ä¸­æ„é€ å®Œæ–°çš„ DOM å…ƒç´ ä»¥åï¼Œå°±ä¼šé€šè¿‡ onStateChange å‘ŠçŸ¥å¤–éƒ¨æ’å…¥æ–°çš„ DOM å…ƒç´ ï¼Œç„¶ååˆ é™¤æ—§çš„å…ƒç´ ï¼Œé¡µé¢å°±æ›´æ–°äº†ã€‚è¿™é‡Œå·²ç»åšåˆ°äº†è¿›ä¸€æ­¥çš„ä¼˜åŒ–äº†ï¼šç°åœ¨ä¸éœ€è¦å†æ‰‹åŠ¨æ›´æ–°é¡µé¢äº†ã€‚
        éä¸€èˆ¬çš„æš´åŠ›ï¼Œå› ä¸ºæ¯æ¬¡ setState éƒ½é‡æ–°æ„é€ ã€æ–°å¢ã€åˆ é™¤ DOM å…ƒç´ ï¼Œä¼šå¯¼è‡´æµè§ˆå™¨è¿›è¡Œå¤§é‡çš„é‡æ’ï¼Œä¸¥é‡å½±å“æ€§èƒ½ã€‚ä¸è¿‡æ²¡æœ‰å…³ç³»ï¼Œè¿™ç§æš´åŠ›è¡Œä¸ºå¯ä»¥è¢«ä¸€ç§å« Virtual-DOM çš„ç­–ç•¥è§„é¿æ‰
         */
        if (this.onStateChange) {
          // console.log(this.onStateChange);
          this.onStateChange(oldEl, this.el);
        }
      }
      changeLikeText() {
        // const likeText = this.el.querySelector('.like_text');
        // this.state.isLiked = !this.state.isLiked;
        // likeText.innerHTML = this.state.isLiked ? "å–æ¶ˆ" : "ç‚¹èµ"
        this.setState({
          isLiked: !this.state.isLiked
        })
      }
      render() {
        this.el = createDOMFromString(`
          <button id="like-btn">
            <span class="like_text">${this.state.isLiked ? "å–æ¶ˆ" : "ç‚¹èµ"}</span>
            <span>ğŸ‘</span>
          </button>
        `)
        this.el.addEventListener("click", this.changeLikeText, false);
        return this.el;
      }
    }
    const wrapper = document.querySelector(".wrapper");
    const likeButton = new LikeButton();
    wrapper.appendChild(likeButton.render());//ç¬¬ä¸€æ¬¡æ’å…¥DOM
    likeButton.onStateChange = (oldEl, newEl) => {
      wrapper.insertBefore(newEl, oldEl);//æ’å…¥æ–°DOM
      wrapper.removeChild(oldEl);//åˆ é™¤åŸDOM
    }
  </script>
</body>

</html>